{{/*
  Archive Page - 对标 hexo: layout/archive.ejs
  
  归档页面，按年月分组显示所有文章
  支持分页功能
  Requirements: 10.1, 10.2, 10.3
*/}}

{{ define "main" }}
{{/* Banner */}}
{{ partial "header/banner.html" (dict 
  "context" . 
  "banner_img" (.Site.Params.archive.banner_img | default "/img/default.png")
  "banner_img_height" (.Site.Params.archive.banner_img_height | default 60)
  "banner_mask_alpha" (.Site.Params.archive.banner_mask_alpha | default 0.3)
  "title" (i18n "archive.title" | default "Archives")
  "subtitle" ""
  "show_scroll_down" false
) }}

{{/* Main Content */}}
<main>
  <div id="board" class="container mx-auto px-4 py-8 -mt-8 relative z-10">
    <div class="site-content mx-auto">
      {{/* 获取所有文章并分页 - 对标 hexo 的 page.posts */}}
      {{ $allPages := where .Site.RegularPages "Section" "in" .Site.Params.mainSections }}
      {{ $totalPosts := len $allPages }}
      
      {{/* 使用 Hugo 分页功能 */}}
      {{ $paginator := .Paginate $allPages }}
      
      {{/* 文章列表 - 对标 hexo: layout/_partials/archive-list.ejs */}}
      <div class="list-group">
        {{/* 文章总数 - 显示总数而非当前页数 */}}
        <p class="h4">{{ i18n "archive.post_total" $totalPosts | default (printf "共计 %d 篇文章" $totalPosts) }}</p>
        <hr class="border-line my-4">
        
        {{/* 按年分组显示当前页的文章 - 对标 hexo 的 dateCursor 逻辑 */}}
        {{ $dateCursor := "" }}
        {{ range $paginator.Pages }}
          {{ $year := .Date.Format "2006" }}
          {{ if ne $year $dateCursor }}
            {{ $dateCursor = $year }}
            <p class="h5 mt-6 mb-3 font-bold text-lg">{{ $year }}</p>
          {{ end }}
          <a href="{{ .RelPermalink }}" class="list-group-item list-group-item-action">
            <time class="text-muted">{{ .Date.Format "01-02" }}</time>
            <div class="list-group-item-title">{{ .Title }}</div>
          </a>
        {{ end }}
        
        {{/* 空状态 */}}
        {{ if eq $totalPosts 0 }}
        <div class="text-center py-12 text-muted">
          {{ i18n "archive.empty" | default "暂无文章" }}
        </div>
        {{ end }}
      </div>
      
      {{/* 分页组件 - 对标 hexo: layout/_partials/paginator.ejs */}}
      {{ if gt $paginator.TotalPages 1 }}
      <div class="mt-8">
        {{ partial "paginator.html" $paginator }}
      </div>
      {{ end }}
    </div>
  </div>
</main>
{{ end }}
